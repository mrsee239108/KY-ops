<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统信息</title>
    <link rel="stylesheet" href="../static/css/system_info.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="window">
        <!-- 窗口标题栏 -->
        <div class="title-bar">
            <div class="title-bar-left">
                <i class="fas fa-info-circle"></i>
                <span data-i18n="system-info">系统信息</span>
            </div>
            <div class="title-bar-right">
                <div class="window-controls">
                    <button class="control-btn theme-toggle" id="theme-toggle-btn" data-i18n-title="toggle-theme" title="切换主题"><i class="fas fa-moon"></i></button>
                    <button class="control-btn refresh" onclick="refreshPage()" data-i18n-title="refresh" title="刷新"><i class="fas fa-sync-alt"></i></button>
                    <button class="control-btn back" onclick="goBack()" data-i18n-title="back" title="返回"><i class="fas fa-arrow-left"></i></button>
                </div>
            </div>
        </div>

        <div class="window-content">
            <!-- 左侧边栏 -->
            <div class="sidebar">
                <div class="user-profile">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info">
                        <div class="username">Root</div>
                        <div class="user-status" data-i18n="online">在线</div>
                    </div>
                </div>

                <nav class="sidebar-nav">
                    <div class="nav-item active" data-nav="system-status">
                        <i class="fas fa-desktop"></i>
                        <span data-i18n="system-status">系统状态</span>
                    </div>
                    <div class="nav-item" data-nav="personalization">
                        <i class="fas fa-palette"></i>
                        <span data-i18n="personalization">个性化</span>
                    </div>
                    <div class="nav-item" data-nav="user-management">
                        <i class="fas fa-users"></i>
                        <span data-i18n="user-management">用户管理</span>
                    </div>
                    <div class="nav-item" data-nav="ssh-management">
                        <i class="fas fa-chart-bar"></i>
                        <span data-i18n="ssh-management">SSH管理</span>
                    </div>
                    <div class="nav-item" data-nav="dns-settings">
                        <i class="fas fa-network-wired"></i>
                        <span data-i18n="dns-settings">DNS设置</span>
                    </div>
                    <div class="nav-item" data-nav="swap-memory">
                        <i class="fas fa-memory"></i>
                        <span data-i18n="swap-memory">Swap虚拟内存</span>
                    </div>
                </nav>
            </div>

            <!-- 主内容区域 -->
            <div class="main-content">
                <div class="content-header">
                    <div class="breadcrumb">
                        <i class="fas fa-info-circle"></i>
                        <span data-i18n="system-info">系统信息</span>
                    </div>
                </div>

                <div class="content-container">
                    <!-- 系统状态面板 -->
                    <div class="content-panel active" id="system-status-panel">
                        <div class="info-grid">
                            <div class="info-row">
                                <div class="info-label" data-i18n="hostname">主机名称</div>
                                <div class="info-value" id="hostname" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="system-name">系统名称</div>
                                <div class="info-value" id="system-name" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="kernel-version">内核版本</div>
                                <div class="info-value" id="kernel-version" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="cpu-model">CPU型号</div>
                                <div class="info-value" id="cpu-model" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="cpu-architecture">CPU架构</div>
                                <div class="info-value" id="cpu-architecture" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="cpu-count">CPU核心数</div>
                                <div class="info-value" id="cpu-count" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="memory-total">内存总大小</div>
                                <div class="info-value" id="memory-total" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="memory-free">内存空闲</div>
                                <div class="info-value" id="memory-free" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="gcc-version">GCC版本</div>
                                <div class="info-value" id="gcc-version" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="glibc-version">Glibc版本</div>
                                <div class="info-value" id="glibc-version" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="jdk-version">JDK版本</div>
                                <div class="info-value" id="jdk-version" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="network-info">网络1</div>
                                <div class="info-value" id="network-info" data-i18n="loading">加载中...</div>
                            </div>
                            
                            <div class="info-row">
                                <div class="info-label" data-i18n="disk-info">磁盘1</div>
                                <div class="info-value" id="disk-info" data-i18n="loading">加载中...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 个性化面板 -->
                    <div class="content-panel" id="personalization-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-palette"></i> <span data-i18n="personalization-settings">个性化设置</span></h3>
                            <p data-i18n="personalization-desc">自定义您的系统外观和行为</p>
                        </div>
                        <div class="settings-grid">
                            <div class="setting-card">
                                <div class="setting-icon"><i class="fas fa-paint-brush"></i></div>
                                <div class="setting-content">
                                    <h4 data-i18n="theme-settings">主题设置</h4>
                                    <p data-i18n="theme-desc">选择您喜欢的界面主题</p>
                                    <select class="setting-select" id="theme-select">
                                        <option value="dark" data-i18n="dark-theme">深色主题</option>
                                        <option value="light" data-i18n="light-theme">浅色主题</option>
                                    </select>
                                </div>
                            </div>
                            <div class="setting-card">
                                <div class="setting-icon"><i class="fas fa-language"></i></div>
                                <div class="setting-content">
                                    <h4 data-i18n="language-settings">语言设置</h4>
                                    <p data-i18n="language-desc">选择系统显示语言</p>
                                    <select class="setting-select" id="language-select"> 
                                        <option value="zh" data-i18n="chinese">简体中文</option>
                                        <option value="en" data-i18n="english">English</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 用户管理面板 -->
                    <div class="content-panel" id="user-management-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-users"></i> <span data-i18n="user-management-title">用户管理</span></h3>
                            <p data-i18n="user-management-desc">管理系统用户账户和权限</p>
                        </div>
                        <div class="user-management-content">
                            <div class="user-actions">
                                <button class="action-button primary"><i class="fas fa-plus"></i> <span data-i18n="add-user">添加用户</span></button>
                                <button class="action-button"><i class="fas fa-edit"></i> <span data-i18n="edit-user">编辑用户</span></button>
                                <button class="action-button danger"><i class="fas fa-trash"></i> <span data-i18n="delete-user">删除用户</span></button>
                            </div>
                            <div class="user-list">
                                <div class="user-item">
                                    <div class="user-avatar"><i class="fas fa-user"></i></div>
                                    <div class="user-details">
                                        <h4>Root</h4>
                                        <p data-i18n="system-admin">系统管理员</p>
                                        <span class="user-status online" data-i18n="online">在线</span>
                                    </div>
                                    <div class="user-actions-mini">
                                        <button class="mini-button"><i class="fas fa-edit"></i></button>
                                        <button class="mini-button"><i class="fas fa-key"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SSH管理面板 -->
                    <div class="content-panel" id="ssh-management-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-terminal"></i> <span data-i18n="ssh-management-title">SSH管理</span></h3>
                            <p data-i18n="ssh-management-desc">管理SSH连接和密钥</p>
                        </div>
                        <div class="ssh-content">
                            <div class="ssh-status">
                                <div class="status-card">
                                    <div class="status-icon active"><i class="fas fa-circle"></i></div>
                                    <div class="status-info">
                                        <h4 data-i18n="ssh-service-status">SSH服务状态</h4>
                                        <p data-i18n="ssh-running-port">运行中 - 端口 22</p>
                                    </div>
                                    <button class="status-toggle" data-i18n="stop">停止</button>
                                </div>
                            </div>
                            <div class="ssh-connections">
                                <h4 data-i18n="active-connections">活动连接</h4>
                                <div class="connection-list">
                                    <div class="connection-item">
                                        <div class="connection-info">
                                            <span class="connection-ip">192.168.1.100</span>
                                            <span class="connection-user">root</span>
                                            <span class="connection-time" data-i18n="minutes-ago">2分钟前</span>
                                        </div>
                                        <button class="disconnect-button" data-i18n="disconnect">断开</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DNS设置面板 -->
                    <div class="content-panel" id="dns-settings-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-network-wired"></i> <span data-i18n="dns-settings-title">DNS设置</span></h3>
                            <p data-i18n="dns-settings-desc">配置域名解析服务器</p>
                        </div>
                        <div class="dns-content">
                            <div class="dns-form">
                                <div class="form-group">
                                    <label data-i18n="primary-dns">主DNS服务器</label>
                                    <input type="text" class="dns-input" value="8.8.8.8" data-i18n-placeholder="primary-dns-placeholder" placeholder="主DNS服务器地址">
                                </div>
                                <div class="form-group">
                                    <label data-i18n="secondary-dns">备用DNS服务器</label>
                                    <input type="text" class="dns-input" value="8.8.4.4" data-i18n-placeholder="secondary-dns-placeholder" placeholder="备用DNS服务器地址">
                                </div>
                                <div class="form-actions">
                                    <button class="dns-button primary" data-i18n="save-settings">保存设置</button>
                                    <button class="dns-button" data-i18n="test-connection">测试连接</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Swap虚拟内存面板 -->
                    <div class="content-panel" id="swap-memory-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-memory"></i> <span data-i18n="swap-memory-title">Swap虚拟内存</span></h3>
                            <p data-i18n="swap-memory-desc">管理系统虚拟内存设置</p>
                        </div>
                        <div class="swap-content">
                            <div class="swap-status">
                                <div class="swap-info-card">
                                    <h4 data-i18n="current-swap-status">当前Swap状态</h4>
                                    <div class="swap-details">
                                        <div class="swap-detail">
                                            <span class="label" data-i18n="total-capacity">总容量:</span>
                                            <span class="value" id="swap-total" data-i18n="loading">加载中...</span>
                                        </div>
                                        <div class="swap-detail">
                                            <span class="label" data-i18n="used">已使用:</span>
                                            <span class="value" id="swap-used" data-i18n="loading">加载中...</span>
                                        </div>
                                        <div class="swap-detail">
                                            <span class="label" data-i18n="usage-rate">使用率:</span>
                                            <span class="value" id="swap-percent" data-i18n="loading">加载中...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../static/js/theme-manager.js"></script>
    <script src="../static/js/system_info.js"></script>
    <script src="../static/js/language-manager.js"></script>
    <script>
        // 页面加载完成后获取系统信息
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化主题管理器
            const themeManager = new ThemeManager();
            themeManager.init();
            
            // 初始化语言管理器
            window.languageManager = new LanguageManager();
            window.languageManager.init();
            
            // 初始化系统信息管理器
            const systemInfoManager = new SystemInfoManager();
            systemInfoManager.init();
            
            loadSystemInfo();
        });

        function loadSystemInfo() {
            // 只从info.txt获取数据
            fetch('../info.txt')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('info.txt文件不存在');
                    }
                    return response.json();
                })
                .then(data => {
                    // 使用info.txt的数据更新界面
                    updateSystemInfoFromTxt(data);
                })
                .catch(error => {
                    console.log('从info.txt获取数据失败:', error);
                    // 显示错误信息
                    showErrorState();
                });
        }

        // 更新元素内容并应用成功样式
        function updateElementWithSuccess(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
                element.className = 'info-value success';
                // 移除data-i18n属性，避免被翻译覆盖
                element.removeAttribute('data-i18n');
            }
        }

        function updateSystemInfoFromTxt(data) {
            try {
                // 更新基本系统信息
                updateElementWithSuccess('hostname', data.base_info['主机名'] || '未知');
                updateElementWithSuccess('system-name', data.base_info['系统版本'] || '未知');
                updateElementWithSuccess('kernel-version', data.base_info['内核版本'] || '未知');
                
                // 更新CPU信息
                updateElementWithSuccess('cpu-model', data.cpu_info['CPU型号'] || '未知');
                updateElementWithSuccess('cpu-architecture', data.cpu_info['CPU架构'] || '未知');
                updateElementWithSuccess('cpu-count', data.cpu_info['CPU核心数'] || '未知');
                
                // 更新内存信息
                const memTotal = data.memory_info['总内存'];
                const memFree = data.memory_info['空闲内存'];
                const memAvailable = data.memory_info['可用内存'];
                
                if (memTotal) {
                    // 将KB转换为更友好的格式
                    const totalBytes = parseInt(memTotal.replace(' KB', '')) * 1024;
                    updateElementWithSuccess('memory-total', formatBytes(totalBytes));
                }
                if (memFree) {
                    const freeBytes = parseInt(memFree.replace(' KB', '')) * 1024;
                    updateElementWithSuccess('memory-free', formatBytes(freeBytes));
                }
                
                // 更新开发工具版本
                updateElementWithSuccess('gcc-version', data.base_info['GCC版本'] || '未知');
                updateElementWithSuccess('glibc-version', data.base_info['Glibc版本'] || '未知');
                updateElementWithSuccess('jdk-version', data.base_info['JDK版本'] || '未安装');
                
                // 更新网络信息
                if (data.network_info && data.network_info.length > 0) {
                    const primaryNet = data.network_info[0];
                    const netInfo = `${primaryNet['接口名']} (${primaryNet['驱动']}) - ${primaryNet['IP地址']}`;
                    updateElementWithSuccess('network-info', netInfo);
                } else {
                    updateElementWithSuccess('network-info', '未知');
                }
                
                // 更新磁盘信息
                if (data.disk_info && data.disk_info.length > 0) {
                    const primaryDisk = data.disk_info[0];
                    const diskInfo = `${primaryDisk['磁盘名']} - ${primaryDisk['总容量']}`;
                    updateElementWithSuccess('disk-info', diskInfo);
                } else {
                    updateElementWithSuccess('disk-info', '未知');
                }
                
                // 更新新增的系统信息项（设置为示例值）
                updateElementWithSuccess('boot-time', '2024-01-22 09:30:15');
                updateElementWithSuccess('uptime', '7天 14小时 25分钟');
                updateElementWithSuccess('load-average', '0.15, 0.18, 0.12');
                updateElementWithSuccess('process-count', '156');
                updateElementWithSuccess('user-sessions', '2');
                updateElementWithSuccess('network-interfaces', '3');
                updateElementWithSuccess('disk-partitions', '4');
                updateElementWithSuccess('python-version', 'Python 3.12.0');
                updateElementWithSuccess('nodejs-version', 'Node.js 18.17.0');
                updateElementWithSuccess('docker-version', 'Docker 24.0.6');
                updateElementWithSuccess('git-version', 'Git 2.42.0');
                updateElementWithSuccess('system-temperature', '45°C');
                updateElementWithSuccess('cpu-usage', '12.5%');
                updateElementWithSuccess('memory-usage', '68.3%');
                updateElementWithSuccess('disk-usage', '42.1%');
                
                console.log('系统信息已从info.txt文件成功加载');
                
            } catch (error) {
                console.error('解析info.txt数据时出错:', error);
                showErrorState();
            }
        }

        function showErrorState() {
            const elements = [
                'hostname', 'system-name', 'kernel-version', 'cpu-model', 
                'cpu-architecture', 'cpu-count', 'memory-total', 'memory-free',
                'gcc-version', 'glibc-version', 'jdk-version', 'network-info', 'disk-info'
            ];
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = '加载失败';
                }
            });
        }

        // 格式化字节数
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
